# VIBECODING: Railway Deployment Configuration
# Documentation: https://docs.railway.app/deploy/config-as-code
# NOTE: Health checks configured per-service in Railway dashboard (web has healthcheck, sidekiq does not)

[build]
builder = "DOCKERFILE"
dockerfilePath = "Containerfile"

[build.args]
# Pass Git SHA for versioning
VCS_REF = "$RAILWAY_GIT_COMMIT_SHA"

[deploy]
# Number of replicas (horizontal scaling)
numReplicas = 1

# Restart policy
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# NOTE: healthcheckPath removed - configure per-service in Railway dashboard
# Web service: Set healthcheck to /api/v1/health_checks/app
# Sidekiq service: Leave healthcheck disabled

# NOTE: migrations should be run manually in Railway dashboard or via release command
# Railway doesn't support [deploy.migration] in v2 - use Procfile release task instead
# [deploy.migration]
# enabled = true
# command = "bundle exec rails db:migrate"

# Networking
[deploy.networking]
# Railway automatically assigns a public URL
# Custom domain can be configured in Railway dashboard

# Observability
[observability]
# Railway provides built-in logging and metrics
# Logs are automatically captured from STDOUT/STDERR

# Notes for Railway Setup:
# =======================
# Required Environment Variables (set in Railway dashboard):
# - SECRET_KEY_BASE (generate with: rails secret)
# - FOREM_OWNER_SECRET (generate with: rails secret)
# - APP_DOMAIN (your Railway domain or custom domain)
# - APP_PROTOCOL=https://
# - RAILS_ENV=production
# - NODE_ENV=production
# - RAILS_SERVE_STATIC_FILES=true
# - RAILS_LOG_TO_STDOUT=true
# - CLOUDINARY_URL (optional but recommended)
# - SENTRY_DSN (optional but recommended)
# - SENDGRID_API_KEY (optional but recommended)
#
# Railway automatically provides:
# - DATABASE_URL (from PostgreSQL plugin)
# - REDIS_URL (from Redis plugin)
# - PORT (automatic)
# - RAILWAY_GIT_COMMIT_SHA (automatic)
