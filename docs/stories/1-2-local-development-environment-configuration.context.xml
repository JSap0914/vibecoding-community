<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>2</storyId>
    <title>Local Development Environment Configuration</title>
    <status>drafted</status>
    <generatedAt>2025-11-09</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-2-local-development-environment-configuration.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Developer</asA>
    <iWant>a working local Forem instance running on my machine</iWant>
    <soThat>I can develop and test customizations locally before deployment</soThat>
    <tasks>
- [ ] Task 1: Verify Story 1.1 completion and prerequisites (AC: 1.2.1, 1.2.2)
  - [ ] Subtask 1.1: Confirm docker-compose.yml exists with PostgreSQL and Redis services
  - [ ] Subtask 1.2: Verify .env file created from .env.example with required variables
  - [ ] Subtask 1.3: Confirm bin/setup script has run successfully
  - [ ] Subtask 1.4: Verify bundle install completed without errors

- [ ] Task 2: Start infrastructure services (AC: 1.2.1, 1.2.2)
  - [ ] Subtask 2.1: Run `docker-compose up -d` to start PostgreSQL and Redis
  - [ ] Subtask 2.2: Verify PostgreSQL container is healthy (port 5432 accessible)
  - [ ] Subtask 2.3: Verify Redis container is healthy (port 6379 accessible)
  - [ ] Subtask 2.4: Test database connectivity with `bin/rails db:version`

- [ ] Task 3: Initialize database and run migrations (AC: 1.2.2)
  - [ ] Subtask 3.1: Run `bin/rails db:create` to create development and test databases
  - [ ] Subtask 3.2: Run `bin/rails db:migrate` to apply all Forem migrations
  - [ ] Subtask 3.3: Verify migration completion without errors
  - [ ] Subtask 3.4: Run `bin/rails db:seed` to load initial seed data
  - [ ] Subtask 3.5: Confirm database schema matches expected structure

- [ ] Task 4: Start Rails application server (AC: 1.2.1)
  - [ ] Subtask 4.1: Start application using `foreman start -f Procfile.dev` or `bin/dev`
  - [ ] Subtask 4.2: Verify Rails server starts on localhost:3000
  - [ ] Subtask 4.3: Verify Sidekiq worker process starts
  - [ ] Subtask 4.4: Verify frontend asset compilation (Webpack/ESBuild) starts
  - [ ] Subtask 4.5: Access http://localhost:3000 and confirm Forem homepage loads

- [ ] Task 5: Verify Rails console functionality (AC: 1.2.3)
  - [ ] Subtask 5.1: Open Rails console with `bin/rails console`
  - [ ] Subtask 5.2: Test database connectivity (`User.count` or similar query)
  - [ ] Subtask 5.3: Test Redis connectivity (`Rails.cache.write` and `Rails.cache.read`)
  - [ ] Subtask 5.4: Verify ActiveRecord models load correctly
  - [ ] Subtask 5.5: Document console in development-guide.md

- [ ] Task 6: Verify Preact frontend and hot-reload (AC: 1.2.4)
  - [ ] Subtask 6.1: Verify frontend assets compile without errors
  - [ ] Subtask 6.2: Make a minor change to a JavaScript file
  - [ ] Subtask 6.3: Confirm hot-reload updates browser without full page refresh
  - [ ] Subtask 6.4: Test Preact components render correctly
  - [ ] Subtask 6.5: Verify source maps work for debugging

- [ ] Task 7: Verify Sidekiq background job processing (AC: 1.2.5)
  - [ ] Subtask 7.1: Access Sidekiq web UI (typically at /sidekiq)
  - [ ] Subtask 7.2: Trigger a background job (e.g., email notification)
  - [ ] Subtask 7.3: Verify job appears in Sidekiq queue
  - [ ] Subtask 7.4: Confirm job processes successfully
  - [ ] Subtask 7.5: Check Redis for job data persistence

- [ ] Task 8: Run and verify test suite (AC: 1.2.6)
  - [ ] Subtask 8.1: Run full RSpec test suite with `bin/rspec`
  - [ ] Subtask 8.2: Verify test database setup works correctly
  - [ ] Subtask 8.3: Confirm all tests pass (or identify expected failures)
  - [ ] Subtask 8.4: Run individual test file to verify targeted testing works
  - [ ] Subtask 8.5: Document test execution commands in development-guide.md

- [ ] Task 9: End-to-end user flow validation (AC: 1.2.7)
  - [ ] Subtask 9.1: Navigate to http://localhost:3000/users/sign_up
  - [ ] Subtask 9.2: Create a test user account
  - [ ] Subtask 9.3: Verify email confirmation workflow (if enabled)
  - [ ] Subtask 9.4: Log in as the test user
  - [ ] Subtask 9.5: Create and publish a test post/article
  - [ ] Subtask 9.6: Verify post appears on homepage
  - [ ] Subtask 9.7: Test commenting on the post

- [ ] Task 10: Document development workflow (AC: All)
  - [ ] Subtask 10.1: Update docs/development-guide.md with startup commands
  - [ ] Subtask 10.2: Document common development tasks (restart server, clear cache, etc.)
  - [ ] Subtask 10.3: Add troubleshooting section for common issues
  - [ ] Subtask 10.4: Document Windows (MINGW64) specific notes if applicable
  - [ ] Subtask 10.5: Add quick reference for key URLs (localhost:3000, /sidekiq, etc.)

- [ ] Task 11: Testing and validation (AC: All)
  - [ ] Subtask 11.1: Perform full developer onboarding simulation (clean environment)
  - [ ] Subtask 11.2: Verify startup time is acceptable (< 60 seconds per tech-spec-epic-1.md)
  - [ ] Subtask 11.3: Test stopping and restarting services
  - [ ] Subtask 11.4: Verify all acceptance criteria are met
  - [ ] Subtask 11.5: Confirm development-guide.md is accurate and complete
    </tasks>
  </story>

  <acceptanceCriteria>
**Given** the project infrastructure from Story 1.1 is complete
**When** I run the local development setup
**Then**:

1. **AC-1.2.1**: The Forem application starts successfully on localhost:3000
2. **AC-1.2.2**: Database migrations run without errors
3. **AC-1.2.3**: Rails console accessible via `bin/rails console`
4. **AC-1.2.4**: Preact frontend compiles and hot-reloads
5. **AC-1.2.5**: Background jobs process via Sidekiq
6. **AC-1.2.6**: Test suite runs via `bin/rspec`
7. **AC-1.2.7**: I can create a test user account and publish a test post
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Platform Foundation & Branding</title>
        <section>Story 1.2: Local Development Environment Configuration</section>
        <snippet>Functional Forem instance on localhost:3000. Database migrations, Rails console, Preact frontend with hot-reload, background jobs via Sidekiq, RSpec test suite execution. Docker Compose for PostgreSQL and Redis.</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Platform Foundation & Branding</title>
        <section>Workflow 1: Developer Onboarding</section>
        <snippet>Start infrastructure: docker-compose up -d (PostgreSQL + Redis). Initialize database: bin/rails db:setup. Start application: foreman start -f Procfile.dev. Access: http://localhost:3000. Run tests: bin/rspec.</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Platform Foundation & Branding</title>
        <section>Performance Requirements</section>
        <snippet>Local dev server startup: &lt; 60 seconds from foreman start to localhost:3000 responsive. Database migration time: &lt; 5 minutes for rails db:migrate.</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Platform Foundation & Branding</title>
        <section>Test Scenarios - Story 1.2</section>
        <snippet>TS-1.2.1-7: foreman start â†’ app runs, migrations succeed, Rails console works, Preact hot reload, Sidekiq processes jobs, RSpec passes, user can register/login/create post (E2E).</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture - Vibecoding Community</title>
        <section>Development Environment</section>
        <snippet>Docker Compose for local PostgreSQL and Redis. Foreman/Overmind for process management. Backend: Ruby on Rails 7.0.8.4, Ruby 3.3.0, Puma. Frontend: Preact 10.20.2, Stimulus, ESBuild. Database: PostgreSQL 14+. Cache/Jobs: Redis 4.7.1+, Sidekiq 6.5.3.</snippet>
      </doc>
      <doc>
        <path>docs/development-guide.md</path>
        <title>Vibecoding Community - Development Setup Guide</title>
        <section>Quick Start</section>
        <snippet>Clone repo, run bin/setup, docker-compose up -d, bin/rails db:setup, foreman start -f Procfile.dev. Prerequisites: Ruby 3.3.0, Node 20.x, PostgreSQL 14+, Redis 7, Yarn 1.22.18, Bundler.</snippet>
      </doc>
      <doc>
        <path>docs/development-guide.md</path>
        <title>Vibecoding Community - Development Setup Guide</title>
        <section>Windows MINGW64 Considerations</section>
        <snippet>Document Windows-specific notes for compatibility. May require WSL2 recommendation for optimal development experience.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>vibecoding-community - Product Requirements Document</title>
        <section>Project Classification</section>
        <snippet>Forem platform (Ruby on Rails 7.0.8, Preact 10.20.2, PostgreSQL with 106+ tables, Redis, Sidekiq, 305+ UI components). Brownfield customization approach - focus on growth and community building rather than rebuilding infrastructure.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>Procfile.dev</path>
        <kind>process-definition</kind>
        <symbol>Development processes</symbol>
        <lines>1-4</lines>
        <reason>Defines development processes: Rails server (port 3000), Sidekiq worker, JavaScript build watcher. Used by foreman/overmind to start all dev services.</reason>
      </artifact>
      <artifact>
        <path>docker-compose.yml</path>
        <kind>infrastructure-config</kind>
        <symbol>PostgreSQL and Redis services</symbol>
        <lines>95-122</lines>
        <reason>Defines PostgreSQL 13 and Redis 7 containers for local development. Includes health checks, volume mounts, network configuration. Critical for Story 1.2 infrastructure.</reason>
      </artifact>
      <artifact>
        <path>bin/dev</path>
        <kind>script</kind>
        <symbol>Development startup script</symbol>
        <lines>1-10</lines>
        <reason>Convenience script for starting development server. May use foreman or overmind internally. Referenced in AC-1.2.1.</reason>
      </artifact>
      <artifact>
        <path>bin/rails</path>
        <kind>script</kind>
        <symbol>Rails CLI wrapper</symbol>
        <lines>1-10</lines>
        <reason>Rails command line interface for console, migrations, generators. Used for AC-1.2.2 (migrations), AC-1.2.3 (console).</reason>
      </artifact>
      <artifact>
        <path>bin/rspec</path>
        <kind>script</kind>
        <symbol>RSpec test runner</symbol>
        <lines>1-10</lines>
        <reason>Test suite runner for backend tests. Referenced in AC-1.2.6.</reason>
      </artifact>
      <artifact>
        <path>bin/setup</path>
        <kind>script</kind>
        <symbol>Initial setup automation</symbol>
        <lines>1-50</lines>
        <reason>Automates dependency installation, database setup, seed data. Prerequisite from Story 1.1 that must be verified in Task 1.</reason>
      </artifact>
      <artifact>
        <path>config/database.yml</path>
        <kind>config</kind>
        <symbol>Database configuration</symbol>
        <lines>N/A</lines>
        <reason>PostgreSQL connection settings for development, test, production. Used by Rails to connect to database in Task 2-3.</reason>
      </artifact>
      <artifact>
        <path>.env.example</path>
        <kind>config-template</kind>
        <symbol>Environment variables template</symbol>
        <lines>N/A</lines>
        <reason>Template for required environment variables (DATABASE_URL, REDIS_URL, SECRET_KEY_BASE, etc.). Must be copied to .env per Story 1.1.</reason>
      </artifact>
      <artifact>
        <path>db/schema.rb</path>
        <kind>schema</kind>
        <symbol>Database schema definition</symbol>
        <lines>N/A</lines>
        <reason>ActiveRecord schema file with 106 Forem tables. Verified after running migrations in Task 3.</reason>
      </artifact>
    </code>
    <dependencies>
      <ruby>
        <gem name="rails" version="~> 7.0.8.4">Ruby on Rails framework</gem>
        <gem name="pg" version="~> 1.4">PostgreSQL adapter</gem>
        <gem name="redis" version="~> 4.7.1">Redis client</gem>
        <gem name="sidekiq" version="~> 6.5.3">Background job processing</gem>
        <gem name="puma" version="~> 5.6.4">Application server</gem>
        <gem name="devise" version="~> 4.8">Authentication</gem>
        <gem name="rspec-rails" version="~> 6.0">Testing framework</gem>
        <gem name="factory_bot_rails">Test data factories</gem>
        <gem name="capybara">Integration testing</gem>
      </ruby>
      <javascript>
        <package name="preact" version="10.20.2">UI framework</package>
        <package name="esbuild" version="~> 0.19">JavaScript bundler</package>
        <package name="jest">JavaScript testing framework</package>
        <package name="cypress" version="^13.7.2">E2E testing</package>
        <package name="@testing-library/preact">Component testing</package>
        <package name="eslint">JavaScript linter</package>
        <package name="node" version="20.x">JavaScript runtime</package>
        <package name="yarn" version="1.22.18">Package manager</package>
      </javascript>
      <system>
        <requirement>Ruby 3.3.0</requirement>
        <requirement>PostgreSQL 14+ (Docker or native)</requirement>
        <requirement>Redis 7 (Docker or native)</requirement>
        <requirement>Docker Desktop (recommended)</requirement>
        <requirement>Foreman or Overmind (process manager)</requirement>
      </system>
    </dependencies>
  </artifacts>

  <constraints>
    <pattern>Brownfield Customization Strategy (ADR-001): Leverage existing Forem platform infrastructure. Minimal customization in Epic 1 - focus on getting Forem running. Follow Forem conventions for development workflow. Maintain upgrade compatibility with Forem.</pattern>
    <pattern>All customizations must be namespaced (vibecoding/, custom/) - not applicable to Story 1.2 which is infrastructure verification only.</pattern>
    <pattern>Git commits prefixed with [VIBECODING] for custom code - not applicable to Story 1.2.</pattern>
    <pattern>Development workflow: Use existing Forem scripts (bin/setup, bin/dev, bin/rails, bin/rspec). Do not modify core Forem infrastructure.</pattern>
    <performance>Local dev server startup &lt; 60 seconds from foreman start to localhost:3000 responsive (tech-spec-epic-1.md).</performance>
    <performance>Database migration time &lt; 5 minutes for rails db:migrate (tech-spec-epic-1.md).</performance>
    <platform>Windows (MINGW64) compatibility: Document Windows-specific issues in development-guide.md. May require WSL2 recommendation.</platform>
    <prerequisite>Story 1.1 must be complete before starting Story 1.2. Verify: docker-compose.yml, .env file, bin/setup run, bundle install complete.</prerequisite>
  </constraints>

  <interfaces>
    <interface>
      <name>Forem Web Application</name>
      <kind>HTTP endpoint</kind>
      <signature>GET http://localhost:3000/</signature>
      <path>N/A (Forem built-in)</path>
      <description>Main application homepage. Should load successfully after development environment is running.</description>
    </interface>
    <interface>
      <name>Sidekiq Web UI</name>
      <kind>HTTP endpoint</kind>
      <signature>GET http://localhost:3000/sidekiq</signature>
      <path>config/routes.rb</path>
      <description>Sidekiq background job monitoring interface. Used to verify job processing in Task 7.</description>
    </interface>
    <interface>
      <name>User Registration</name>
      <kind>HTTP endpoint</kind>
      <signature>GET http://localhost:3000/users/sign_up</signature>
      <path>N/A (Devise/Forem built-in)</path>
      <description>User registration page. Used in E2E validation (Task 9, AC-1.2.7).</description>
    </interface>
    <interface>
      <name>Rails Console</name>
      <kind>CLI interface</kind>
      <signature>bin/rails console</signature>
      <path>bin/rails</path>
      <description>Interactive Rails console for database queries and debugging. AC-1.2.3.</description>
    </interface>
    <interface>
      <name>Database Connection</name>
      <kind>Database connection</kind>
      <signature>postgres://localhost:5432 (via DATABASE_URL)</signature>
      <path>config/database.yml</path>
      <description>PostgreSQL database connection. Health check: bin/rails db:version</description>
    </interface>
    <interface>
      <name>Redis Connection</name>
      <kind>Cache/queue connection</kind>
      <signature>redis://localhost:6379 (via REDIS_URL)</signature>
      <path>config/initializers/redis.rb</path>
      <description>Redis cache and Sidekiq queue connection. Tested via Rails.cache operations in console.</description>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Story 1.2 is manual verification testing (not automated unit tests). Focus on confirming all development environment components work together. Testing frameworks available: RSpec for backend (bin/rspec), Jest for frontend (yarn test), Cypress for E2E (bin/e2e). Forem existing test suite should pass (AC-1.2.6). Performance validation required: startup time &lt; 60 seconds.
    </standards>
    <locations>
      <location>spec/ - RSpec backend tests</location>
      <location>app/javascript/**/__tests__/ - Jest frontend tests</location>
      <location>cypress/ - E2E tests</location>
      <location>bin/rspec - Test runner for backend</location>
      <location>bin/e2e - E2E test runner</location>
    </locations>
    <ideas>
      <idea ac="AC-1.2.1">Manual: Run foreman start -f Procfile.dev, time startup, verify http://localhost:3000 loads within 60 seconds. Check all processes start (web, sidekiq, js).</idea>
      <idea ac="AC-1.2.2">Manual: Run bin/rails db:migrate, verify completes &lt; 5 minutes, check db/schema.rb updated, verify no errors in output.</idea>
      <idea ac="AC-1.2.3">Manual: Open bin/rails console, run User.count, Rails.cache.write('test', 'value'), Rails.cache.read('test'). Verify responses.</idea>
      <idea ac="AC-1.2.4">Manual: Edit app/javascript file, save, verify browser auto-refreshes without manual reload. Check console for hot-reload messages.</idea>
      <idea ac="AC-1.2.5">Manual: Access /sidekiq in browser, trigger background job (create article, send notification), verify job appears and processes in Sidekiq UI.</idea>
      <idea ac="AC-1.2.6">Automated: Run bin/rspec, verify full test suite passes (or identify expected failures). Document any known test failures in development-guide.md.</idea>
      <idea ac="AC-1.2.7">Manual E2E: Navigate to /users/sign_up, create test account, login, create post, verify post appears on homepage, test commenting. Document flow.</idea>
      <idea ac="All">Performance: Time full startup from docker-compose up to first page load. Must be &lt; 60 seconds total for AC compliance.</idea>
      <idea ac="All">Documentation: Update docs/development-guide.md with exact commands tested, troubleshooting notes for Windows MINGW64, common errors encountered.</idea>
    </ideas>
  </tests>
</story-context>
